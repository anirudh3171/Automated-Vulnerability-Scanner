
import scanner
import re
import header
import subprocess, optparse
while(True):
    parser = optparse.OptionParser()
    parser.add_option("-u","--url",dest="target_url",help="Target URL")
    (options, argument) = parser.parse_args()
    target_url = options.target_url
    if target_url == None:
        # subprocess.call("clear",shell=True)
        print("Please Try again with format: python3 vulnerability_scanner.py -u <Target URL> ")
        exit(0)
    if target_url[:len(target_url)] is not "/":
        target_url += '/'
    break

print(target_url)
# target_url = "http://127.0.0.1:80/dvwa/" #""http://127.0.0.1/mutillidae/"
# target_url = "http://jiit.ac.in/"
# target_url = "https://www.intellify.in"
# target_url = "https://airtel.in"
# target_url = "http://testphp.vulnweb.com/"
# links_to_ignore =[]#"http://127.0.0.1:80/dvwa/logout.php","http://127.0.0.1:80/dvwa/instructions.php?doc=","http://testphp.vulnweb.com/logout.php","http://127.0.0.1/mutillidae/set-up-database.php","http://127.0.0.1/mutillidae/index.php?do=logout"]                                                # create a regex for 

# data_dict = {"username": "admin", "password": "password", "Login": "submit"}      #automate finding the tags and use master dictionary
# header.print_it()
# # login_url = "http://127.0.0.1/mutillidae/index.php?page=login.php"
login_url = "http://127.0.0.1:80/dvwa/login.php"

vuln_scanner = scanner.Scanner(target_url)
# print(1)
# vuln_scanner.session.post("http://127.0.0.1:80/dvwa/login.php", data=data_dict)     #yaha login wala url usehoga, just to login and make a session   #after upar wala commnet, this will be in loop
# print(2)
# vuln_scanner.crawl(target_url)
# form_test_url = "http://localhost/mutillidae/index.php?page=dns-lookup.php"
# forms = vuln_scanner.extract_form(form_test_url) #jaha se extract krna h
# # print(forms)

# # response = vuln_scanner.submit_form(forms[1],"test",form_test_url)
# # print(response.content)

# # response = vuln_scanner.test_xss_in_forms(forms[1],form_test_url)
# response = vuln_scanner.test_xss_in_link(form_test_url)
# print(response)
vuln_scanner.print_target_info()
vuln_scanner.crawl(target_url)
vuln_scanner.run_scanner()
# vuln_scanner.e_mail_disc("http://localhost:80/dvwa/vulnerabilities/fi/?page=file1.php")
# vuln_scanner.vuln_service_scan(target_url)
# vuln_scanner.mis_cors("http://ptl-ad42da05-c93d6931.libcurl.so/")
# vuln_scanner.host_header_inj(target_url)
# vuln_scanner.insecure_file_upload("http://127.0.0.1/dvwa/vulnerabilities/upload/")
# ########################################################################
# links_to_ignore = ["logout wala yaha, on parsing logout.php session logot ho jayega"]
# target_url = "http://127.0.0.1/mutillidae/"
# vuln_scanner = scanner.Scanner(target_url,links_to_ignore)

# dirs = [".json",".htacess"]           # yaha dictionary aayegi sensitive directories ki
# for dir_list in dirs:
#     is_vulnerable_to_SDD = vuln_scanner.sensetive_directory_disclosure(target_url,dir_list)
#     if (is_vulnerable_to_SDD):
#         print("\n\n\nPublic Sensitive Data Directory: "+dir_list)
